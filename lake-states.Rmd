---
title: "NCA Timber: Lake States"
output: html_notebook
---

```{r}
library(tidyverse)
```


```{r}
# read in .xsl data as dataframe
library(readxl)

# read tables from excel and drop first column

merchBio <- read_excel("Merch Bio GLakes 06-14-2021.xlsx") %>% select(-1)
premerchBio <- read_excel("Premerch Bio GLakes 06-14-2024.xlsx") %>% select(-1)
```

# Organize the FIA data

```{r}
# join the two dataframes
df <- left_join(merchBio, premerchBio, by = c('STATENM','STATECD', 'COUNTYNM',
                                              'COUNTYCD', 'SPGRPCD', 'SPGRPNM',
                                              'SPCLASS', 'UNITCD', 'EVALID',
                                              'RESERVCD')) %>%
                  filter(RESERVCD == 0)

# pivot longer on columns 11 to 33
# drop if biomass is NA
df <- df %>% pivot_longer(cols = 11:33,
                          names_to = 'sizeClass',
                          values_to = 'biomass') %>%
            filter(!is.na(biomass))

```


# summarize the data

```{r}
# create a table that shows the distribution of biomass by size class and state
df %>% group_by(STATENM, sizeClass) %>%
  summarise(totalBiomass = sum(biomass), .groups = 'drop') %>%
  pivot_wider(names_from = sizeClass, values_from = totalBiomass) %>%
  mutate(total = rowSums(select(., -STATENM))) %>%
  arrange(desc(total))
```

```{r}
# create a panel of histograms by state showing the distribution of biomass,
# restrict the data to drop biomass in the top 10% of the distribution
df %>% group_by(STATENM) %>%
  filter(biomass < quantile(biomass, 0.9)) %>%
  ggplot(aes(x = biomass)) +
  geom_histogram(bins = 30) +
  facet_wrap(~STATENM, scales = 'free_y') +
  labs(title = 'Distribution of Biomass by State',
       x = 'Biomass (kg/ha)',
       y = 'Count')


```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

